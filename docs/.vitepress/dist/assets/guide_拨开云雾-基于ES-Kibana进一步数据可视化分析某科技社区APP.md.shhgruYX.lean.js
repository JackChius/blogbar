import{_ as i,c as a,a3 as n,o as t}from"./chunks/framework.BISkuWHZ.js";const o=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/拨开云雾-基于ES-Kibana进一步数据可视化分析某科技社区APP.md","filePath":"guide/拨开云雾-基于ES-Kibana进一步数据可视化分析某科技社区APP.md"}'),l={name:"guide/拨开云雾-基于ES-Kibana进一步数据可视化分析某科技社区APP.md"};function p(h,s,e,k,r,E){return t(),a("div",null,s[0]||(s[0]=[n(`<h4 id="前期工作" tabindex="-1">前期工作 <a class="header-anchor" href="#前期工作" aria-label="Permalink to &quot;前期工作&quot;">​</a></h4><p>1.<strong>部署Elasticsearch</strong></p><blockquote><p>路径位置 /usr/share/elasticsearch 配置文件 /etc/elasticsearch/elasticsearch.yml 启动ES 1）service elasticsearch start</p></blockquote><ol start="2"><li>/usr/share/elasticsearch/bin/elasticsearch -d (守护进程方式，后台持久化运行)</li></ol><ol start="2"><li><strong>部署Kibana</strong></li></ol><blockquote><p>路径位置 /usr/share/kibana 配置文件 /etc/kibana/kibana.yml 启停Kibana service kibana start/stop ps -ef | grep kibana</p></blockquote><h4 id="遇到的问题及解决方法" tabindex="-1">遇到的问题及解决方法 <a class="header-anchor" href="#遇到的问题及解决方法" aria-label="Permalink to &quot;遇到的问题及解决方法&quot;">​</a></h4><p>1.<strong>Elasticsearch:7.6.0启动失败，ERROR: [1] bootstrap checks failed</strong></p><blockquote><p>解决方法： 1）临时通行：在启动命令中添加 -e &quot;discovery.type=single-node&quot; 设置ES为单主机模式 2）永久生效：在ES的配置yml中加入上述命令，并重新启动ES以保持永久生效。 2.<strong>用户权限问题</strong> 无论是es还是kibana在启动过程中均可能遇到用户权限不足的问题，但这是实测不能切换到root用户，而是必须要切换到程序专属的elastic用户 <strong>su elastic</strong><strong>./elasticsearch -d -E &quot;discovery.type=single-node&quot;</strong></p></blockquote><h4 id="命令行查询测试" tabindex="-1">命令行查询测试 <a class="header-anchor" href="#命令行查询测试" aria-label="Permalink to &quot;命令行查询测试&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>curl -H &quot;Content-Type: application/json&quot; -XPUT --user elastic:xxxxxx &#39;http://localhost:9200/_settings&#39; -d &#39;</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>     &quot;index&quot; : {</span></span>
<span class="line"><span>        &quot;number_of_replicas&quot; : 0</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span>}&#39;</span></span></code></pre></div><h4 id="实战-app数据转化到es索引并插入数据" tabindex="-1">实战：APP数据转化到ES索引并插入数据 <a class="header-anchor" href="#实战-app数据转化到es索引并插入数据" aria-label="Permalink to &quot;实战：APP数据转化到ES索引并插入数据&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elasticsearch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Elasticsearch, helpers </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#引入helpers对象提供es批量插入接口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insert_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app_data_list):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app_data_list:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cool_data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;_source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 用户id</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;author_user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.user_id,              </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 性别</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;gender&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.gender,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 昵称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;nickname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.nickname,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 归属地</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;region&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.region,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 用户发表内容</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;ueer_content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.ueer_content,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 内容创建时间</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;create_time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: handle_date(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.creat_time, key=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ims&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 设备IP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;device_ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.device_ip,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 抓取时间</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;crawl_time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: handle_date(item.craw_time, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cms&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),             </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 手机型号</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;user_phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.user_phone,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # 标签</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;tag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.tag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # print(info)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data_list.append(info)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 通过helpers插入数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    helpers.bulk(es, data_list)</span></span></code></pre></div><h5 id="分离两种情况-时间处理函数-判断抓取时间和内容创建时间" tabindex="-1">分离两种情况,时间处理函数,判断抓取时间和内容创建时间 <a class="header-anchor" href="#分离两种情况-时间处理函数-判断抓取时间和内容创建时间" aria-label="Permalink to &quot;分离两种情况,时间处理函数,判断抓取时间和内容创建时间&quot;">​</a></h5><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elasticsearch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Elasticsearch, helpers </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#引入helpers对象提供es批量插入接口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insert_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app_data_list):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app_data_list:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;_index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cool_data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;_source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 用户id</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;author_user_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.user_id,              </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 性别</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;gender&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.gender,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 昵称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;nickname&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.nickname,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 归属地</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;region&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.region,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 用户发表内容</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;ueer_content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.ueer_content,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 内容创建时间</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;create_time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: handle_date(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.creat_time, key=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ims&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 设备IP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;device_ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.device_ip,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 抓取时间</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;crawl_time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: handle_date(item.craw_time, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cms&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),             </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # 手机型号</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;user_phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.user_phone,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # 标签</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;tag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item.tag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # print(info)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data_list.append(info)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 通过helpers插入数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    helpers.bulk(es, data_list)</span></span></code></pre></div><h5 id="根据不同维度-角度生成可视化图表" tabindex="-1">根据不同维度，角度生成可视化图表 <a class="header-anchor" href="#根据不同维度-角度生成可视化图表" aria-label="Permalink to &quot;根据不同维度，角度生成可视化图表&quot;">​</a></h5><p><img src="https://i.loli.net/2021/08/04/SLXYf1ijTngEslq.png" alt="4f7a82ce87d989cc1773ba867f3a5f3"></p><p><img src="https://i.loli.net/2021/08/04/HE5rWSkl4VYh7Xa.png" alt="20210804112340"></p><p>通过Es图表数据可以看到 每天抓取数据 频率在一定时间保持在一个稳定频率，程序运行稳定。</p><p>性别和年龄对比，以男性占多，</p><p>手机型号统计 国内厂商占大多数 容量大小方面，8+128g为绝对主流。 <strong>未完待续。。。</strong></p>`,21)]))}const c=i(l,[["render",p]]);export{o as __pageData,c as default};
